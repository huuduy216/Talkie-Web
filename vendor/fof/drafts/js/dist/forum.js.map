{"version":3,"sources":["webpack://@fof/drafts/webpack/bootstrap","webpack://@fof/drafts/./forum.js","webpack://@fof/drafts/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://@fof/drafts/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@fof/drafts/./node_modules/external-load/index.js","webpack://@fof/drafts/./src/forum/addDraftsDropdown.js","webpack://@fof/drafts/./src/forum/addPreferences.js","webpack://@fof/drafts/./src/forum/components/DraftsDropdown.js","webpack://@fof/drafts/./src/forum/components/DraftsList.js","webpack://@fof/drafts/./src/forum/components/DraftsPage.js","webpack://@fof/drafts/./src/forum/components/ScheduleDraftModal.js","webpack://@fof/drafts/./src/forum/index.js","webpack://@fof/drafts/./src/forum/models/Draft.js","webpack://@fof/drafts/./src/forum/utils/fillRelationship.js","webpack://@fof/drafts/external \"flarum.extensions['fof-byobu']\"","webpack://@fof/drafts/external \"flarum.core.compat['Component']\"","webpack://@fof/drafts/external \"flarum.core.compat['Model']\"","webpack://@fof/drafts/external \"flarum.core.compat['app']\"","webpack://@fof/drafts/external \"flarum.core.compat['components/Alert']\"","webpack://@fof/drafts/external \"flarum.core.compat['components/Button']\"","webpack://@fof/drafts/external \"flarum.core.compat['components/Composer']\"","webpack://@fof/drafts/external \"flarum.core.compat['components/DiscussionComposer']\"","webpack://@fof/drafts/external \"flarum.core.compat['components/FieldSet']\"","webpack://@fof/drafts/external \"flarum.core.compat['components/HeaderSecondary']\"","webpack://@fof/drafts/external \"flarum.core.compat['components/LoadingIndicator']\"","webpack://@fof/drafts/external \"flarum.core.compat['components/Modal']\"","webpack://@fof/drafts/external \"flarum.core.compat['components/NotificationsDropdown']\"","webpack://@fof/drafts/external \"flarum.core.compat['components/Page']\"","webpack://@fof/drafts/external \"flarum.core.compat['components/ReplyComposer']\"","webpack://@fof/drafts/external \"flarum.core.compat['components/SettingsPage']\"","webpack://@fof/drafts/external \"flarum.core.compat['components/Switch']\"","webpack://@fof/drafts/external \"flarum.core.compat['extend']\"","webpack://@fof/drafts/external \"flarum.core.compat['helpers/avatar']\"","webpack://@fof/drafts/external \"flarum.core.compat['helpers/humanTime']\"","webpack://@fof/drafts/external \"flarum.core.compat['helpers/icon']\"","webpack://@fof/drafts/external \"flarum.core.compat['models/User']\"","webpack://@fof/drafts/external \"flarum.core.compat['utils/ItemList']\"","webpack://@fof/drafts/external \"flarum.core.compat['utils/mixin']\"","webpack://@fof/drafts/external \"flarum.core.compat['utils/string']\""],"names":["extend","HeaderSecondary","prototype","items","app","session","user","forum","attribute","add","SettingsPage","draftAutosaveInterval","m","prop","preferences","FieldSet","component","label","translator","trans","className","children","draftsItems","toArray","ItemList","Switch","state","draftAutosaveEnable","onchange","value","preferenceSaver","withAttr","Button","onclick","isInt","str","Math","round","draftAutosaveIntervalInvalid","redraw","DraftsDropdown","initProps","props","icon","init","list","DraftsList","goToRoute","route","getUnreadCount","cache","draftsLoaded","store","all","length","draftCount","getNewCount","NotificationsDropdown","config","isInitialized","$","on","event","stopPropagation","view","drafts","style","title","e","loading","window","confirm","promise","forEach","draft","push","then","composer","id","changed","hide","Promise","sort","a","b","updatedAt","map","showComposer","bind","avatar","type","loadRelationships","discussion","humanTime","deleteDraft","scheduledValidationError","scheduledFor","scheduleDraft","truncate","content","LoadingIndicator","modal","show","ScheduleDraftModal","deferred","componentClass","require","components","ReplyComposer","DiscussionComposer","compileData","load","resolve","find","Component","DraftsPage","history","bodyClass","render","Page","datetime","moment","format","error","unscheduleMode","rescheduleMode","url","flatpickr","js","css","enableTime","enableSeconds","minDate","Date","now","maxDate","defaultDate","val","getTimeOrNull","date","getTime","onsubmit","preventDefault","save","clearValidationError","success","loaded","Modal","initializers","models","Draft","User","Model","hasMany","routes","path","Composer","data","fields","Object","keys","filter","element","getData","field","editor","attributes","relationships","equalRelationships","relationship","getId","dataIds","fillRelationship","draftIds","some","i","saving","afterSave","justSaved","setTimeout","createRecord","position","PositionEnum","MINIMIZED","classNames","join","itemClassName","disabled","saveDraft","autosaveInterval","setInterval","clearInterval","override","original","confirmExit","prevented","initComposerBody","key","includes","deleteDraftsOnSubmit","addDraftsDropdown","addPreferences","mixin","hasOne","transformDate","loadedRelationships","flarum","extensions","force","relationshipName","model","getById","recipients","group","originalContent","Array","isArray"],"mappings":";;QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;;AClFA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;ACAA;AAAA;AAAe;AACf;AACA,mBAAmB,sBAAsB;AACzC;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,C;;;;;;;;;;;;AChBA;AAAA;AAAe;AACf;AACA;AACA;AACA,C;;;;;;;;;;;;ACJA;AAAA;AACA;AACA;AACA;AACA;AACe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,CAAC,GAAG,EAAC;;;;;;;;;;;;;AC/CL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;AAWA;AACA;AACA;AACA;AAEe,2EAAY;AACvBA,8DAAM,CAACC,wEAAe,CAACC,SAAjB,EAA4B,OAA5B,EAAqC,UAAUC,KAAV,EAAiB;AACxD,QAAI,CAACC,iDAAG,CAACC,OAAJ,CAAYC,IAAb,IAAqB,CAACF,iDAAG,CAACG,KAAJ,CAAUC,SAAV,CAAoB,eA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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./forum.js\");\n","/*\r\n *\r\n *  This file is part of fof/drafts.\r\n *\r\n *  Copyright (c) 2019 FriendsOfFlarum.\r\n *\r\n *  For the full copyright and license information, please view the LICENSE.md\r\n *  file that was distributed with this source code.\r\n *\r\n */\r\n\r\nexport * from './src/forum';\r\n","export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","/**\n * Simple resource loader based on David Walsh's tutorial\n * https://davidwalsh.name/javascript-loader\n * https://davidwalsh.name/javascript-functions\n */\nexport default (function() {\n    // Function which returns a function\n    function _load(tag) {\n        return function(url) {\n            // This promise will be used by Promise.all to determine success or failure\n            return new Promise(function(resolve, reject) {\n                var element = document.createElement(tag);\n                var parent = \"body\";\n                var attr = \"src\";\n\n                // Important success and error for the promise\n                element.onload = function() {\n                    resolve(url);\n                };\n                element.onerror = function() {\n                    reject(url);\n                };\n\n                // Need to set different attributes depending on tag type\n                switch (tag) {\n                    case \"script\":\n                        element.async = true;\n                        break;\n                    case \"link\":\n                        element.type = \"text/css\";\n                        element.rel = \"stylesheet\";\n                        attr = \"href\";\n                        parent = \"head\";\n                }\n\n                // Inject into document to kick off loading\n                element[attr] = url;\n                document[parent].appendChild(element);\n            });\n        };\n    }\n\n    return {\n        css: _load(\"link\"),\n        js: _load(\"script\"),\n        img: _load(\"img\")\n    };\n})();\n","/*\r\n *\r\n *  This file is part of fof/drafts.\r\n *\r\n *  Copyright (c) 2019 FriendsOfFlarum.\r\n *\r\n *  For the full copyright and license information, please view the LICENSE.md\r\n *  file that was distributed with this source code.\r\n *\r\n */\r\n\r\nimport { extend } from 'flarum/extend';\r\nimport app from 'flarum/app';\r\nimport HeaderSecondary from 'flarum/components/HeaderSecondary';\r\nimport DraftsDropdown from './components/DraftsDropdown';\r\n\r\nexport default function () {\r\n    extend(HeaderSecondary.prototype, 'items', function (items) {\r\n        if (!app.session.user || !app.forum.attribute('canSaveDrafts')) return;\r\n\r\n        items.add('Drafts', <DraftsDropdown />, 20);\r\n    });\r\n}\r\n","import { extend, override } from 'flarum/extend';\r\nimport Button from 'flarum/components/Button';\r\nimport FieldSet from 'flarum/components/FieldSet';\r\nimport SettingsPage from 'flarum/components/SettingsPage';\r\nimport Switch from 'flarum/components/Switch';\r\nimport ItemList from 'flarum/utils/ItemList';\r\n\r\nexport default function () {\r\n    extend(SettingsPage.prototype, 'init', function () {\r\n        this.draftAutosaveInterval = m.prop(this.user.preferences().draftAutosaveInterval);\r\n    });\r\n\r\n    extend(SettingsPage.prototype, 'settingsItems', function (items) {\r\n        items.add(\r\n            'drafts',\r\n            FieldSet.component({\r\n                label: app.translator.trans('fof-drafts.forum.user.settings.drafts_heading'),\r\n                className: 'Settings-drafts',\r\n                children: this.draftsItems().toArray(),\r\n            })\r\n        );\r\n    });\r\n\r\n    SettingsPage.prototype['draftsItems'] = function () {\r\n        const items = new ItemList();\r\n\r\n        items.add(\r\n            'draft-autosave-enable',\r\n            Switch.component({\r\n                children: app.translator.trans('fof-drafts.forum.user.settings.draft_autosave_enable'),\r\n                state: this.user.preferences().draftAutosaveEnable,\r\n                onchange: (value, component) => this.preferenceSaver('draftAutosaveEnable')(value, component),\r\n            })\r\n        );\r\n\r\n        items.add(\r\n            'draft-autosave-interval',\r\n            this.user.preferences().draftAutosaveEnable ? (\r\n                <label>\r\n                    <p>{app.translator.trans('fof-drafts.forum.user.settings.draft_autosave_interval_label')}</p>\r\n                    <input\r\n                        className=\"FormControl\"\r\n                        type=\"number\"\r\n                        min=\"0\"\r\n                        value={this.draftAutosaveInterval()}\r\n                        onchange={m.withAttr('value', this.draftAutosaveInterval)}\r\n                    />\r\n                    {Button.component({\r\n                        className: 'Button Button--primary',\r\n                        children: app.translator.trans('fof-drafts.forum.user.settings.draft_autosave_interval_button'),\r\n                        onclick: () => {\r\n                            const isInt = (str) => str == Math.round(str);\r\n                            if (this.draftAutosaveInterval() < 0 || !isInt(this.draftAutosaveInterval())) {\r\n                                this.draftAutosaveIntervalInvalid = true;\r\n                                this.draftAutosaveInterval(this.user.preferences().draftAutosaveInterval);\r\n                                m.redraw();\r\n                            } else {\r\n                                this.draftAutosaveIntervalInvalid = false;\r\n                                this.preferenceSaver('draftAutosaveInterval')(this.draftAutosaveInterval());\r\n                            }\r\n                        },\r\n                    })}\r\n                    {this.draftAutosaveIntervalInvalid ? (\r\n                        <p class=\"invalidInterval\">\r\n                            <small>{app.translator.trans('fof-drafts.forum.user.settings.draft_autosave_interval_invalid')}</small>\r\n                        </p>\r\n                    ) : (\r\n                        ''\r\n                    )}\r\n                </label>\r\n            ) : (\r\n                ''\r\n            )\r\n        );\r\n\r\n        return items;\r\n    };\r\n}\r\n","/*\r\n *\r\n *  This file is part of fof/drafts.\r\n *\r\n *  Copyright (c) 2019 FriendsOfFlarum.\r\n *\r\n *  For the full copyright and license information, please view the LICENSE.md\r\n *  file that was distributed with this source code.\r\n *\r\n */\r\n\r\nimport NotificationsDropdown from 'flarum/components/NotificationsDropdown';\r\n\r\nimport DraftsList from './DraftsList';\r\n\r\nexport default class DraftsDropdown extends NotificationsDropdown {\r\n    static initProps(props) {\r\n        props.label = props.label || app.translator.trans('fof-drafts.forum.dropdown.tooltip');\r\n        props.icon = props.icon || 'fas fa-edit';\r\n\r\n        super.initProps(props);\r\n    }\r\n\r\n    init() {\r\n        super.init();\r\n\r\n        this.list = new DraftsList();\r\n    }\r\n\r\n    goToRoute() {\r\n        m.route(app.route('drafts'));\r\n    }\r\n\r\n    getUnreadCount() {\r\n        if (app.cache.draftsLoaded) {\r\n            return app.store.all('drafts').length;\r\n        }\r\n\r\n        return app.store.all('drafts').length + app.session.user.draftCount();\r\n    }\r\n\r\n    getNewCount() {\r\n        return this.getUnreadCount();\r\n    }\r\n}\r\n","/*\r\n *\r\n *  This file is part of fof/drafts.\r\n *\r\n *  Copyright (c) 2019 FriendsOfFlarum.\r\n *\r\n *  For the full copyright and license information, please view the LICENSE.md\r\n *  file that was distributed with this source code.\r\n *\r\n */\r\n\r\nimport Component from 'flarum/Component';\r\nimport LoadingIndicator from 'flarum/components/LoadingIndicator';\r\nimport DiscussionComposer from 'flarum/components/DiscussionComposer';\r\nimport ReplyComposer from 'flarum/components/ReplyComposer';\r\nimport avatar from 'flarum/helpers/avatar';\r\nimport icon from 'flarum/helpers/icon';\r\nimport humanTime from 'flarum/helpers/humanTime';\r\nimport { truncate } from 'flarum/utils/string';\r\nimport Button from 'flarum/components/Button';\r\nimport ScheduleDraftModal from './ScheduleDraftModal';\r\nimport fillRelationship from '../utils/fillRelationship';\r\n\r\nexport default class DraftsList extends Component {\r\n    config(isInitialized) {\r\n        if (!isInitialized) return;\r\n\r\n        $('.draft--delete').on('click tap', function (event) {\r\n            event.stopPropagation();\r\n        });\r\n    }\r\n\r\n    view() {\r\n        const drafts = app.store.all('drafts');\r\n\r\n        return (\r\n            <div className=\"NotificationList DraftsList\">\r\n                <div className=\"NotificationList-header\">\r\n                    <h4 className=\"App-titleControl App-titleControl--text\">{app.translator.trans('fof-drafts.forum.dropdown.title')}</h4>\r\n                    {Button.component({\r\n                                                      icon: 'fas fa-trash-alt',\r\n                                                      style: 'float: right; z-index: 20; margin-top: -25px',\r\n                                                      className: 'Button Button--icon Button--link draft--delete draft--delete',\r\n                                                      title: app.translator.trans('fof-drafts.forum.dropdown.delete_button1'),\r\n                                                      onclick: (e) => {\r\n                                                        this.loading = true;\r\n                                                        if (!window.confirm(app.translator.trans('fof-drafts.forum.dropdown.alert_vi'))) return;\r\n                                                        var promise = [];\r\n                                                        drafts.forEach((draft) =>\r\n                                                            promise.push(\r\n                                                                draft.delete().then(() => {\r\n                                                                    if (\r\n                                                                        app.composer.component &&\r\n                                                                        app.composer.component.draft.id() ===  draft.id() &&\r\n                                                                        !app.composer.changed()\r\n                                                                    ) {\r\n                                                                        app.composer.hide();\r\n                                                                   }\r\n                                                                })\r\n                                                            )\r\n                                                        );\r\n                                                        Promise.all(promise).then(() => {\r\n                                                            this.loading = false;\r\n                                                            m.redraw();\r\n                                                        });\r\n                                                          e.stopPropagation();\r\n                                                      },\r\n                                                  })}\r\n                </div>\r\n                <div className=\"NotificationList-content\">\r\n                    <ul className=\"NotificationGroup-content\">\r\n                        {drafts.length\r\n                            ? drafts\r\n                                  .sort((a, b) => b.updatedAt() - a.updatedAt())\r\n                                  .map((draft) => {\r\n                                      return (\r\n                                          <li>\r\n                                              <a onclick={this.showComposer.bind(this, draft)} className=\"Notification draft--item\">\r\n                                                  {avatar(draft.user())}\r\n                                                  {icon(draft.icon(), { className: 'Notification-icon' })}\r\n                                                  <span className=\"Notification-content\">\r\n                                                      {draft.type() === 'reply' ? draft.loadRelationships().discussion.title() : draft.title()}\r\n                                                  </span>\r\n                                                  {humanTime(draft.updatedAt())}\r\n                                                  {Button.component({\r\n                                                      icon: 'fas fa-times',\r\n                                                      style: 'float: right; z-index: 20;',\r\n                                                      className: 'Button Button--icon Button--link draft--delete draft--delete',\r\n                                                      title: app.translator.trans('fof-drafts.forum.dropdown.delete_button'),\r\n                                                      onclick: (e) => {\r\n                                                          this.deleteDraft(draft);\r\n                                                          e.stopPropagation();\r\n                                                      },\r\n                                                  })}\r\n                                                  {app.forum.attribute('canScheduleDrafts') && app.forum.attribute('drafts.enableScheduledDrafts')\r\n                                                      ? Button.component({\r\n                                                            icon: draft.scheduledValidationError()\r\n                                                                ? 'fas fa-calendar-times'\r\n                                                                : draft.scheduledFor()\r\n                                                                ? 'fas fa-calendar-check'\r\n                                                                : 'fas fa-calendar-plus',\r\n                                                            style: 'float: right; z-index: 20;',\r\n                                                            className: 'Button Button--icon Button--link draft--schedule',\r\n                                                            title: app.translator.trans('fof-drafts.forum.dropdown.schedule_button'),\r\n                                                            onclick: (e) => {\r\n                                                                this.scheduleDraft(draft);\r\n                                                                e.stopPropagation();\r\n                                                            },\r\n                                                        })\r\n                                                      : ''}\r\n                                                  <div className=\"Notification-excerpt\">{truncate(draft.content(), 200)}</div>\r\n                                                  {draft.scheduledValidationError() ? (\r\n                                                      <p className=\"scheduledValidationError\">{draft.scheduledValidationError()}</p>\r\n                                                  ) : (\r\n                                                      ''\r\n                                                  )}\r\n                                              </a>\r\n                                          </li>\r\n                                      );\r\n                                  })\r\n                            : ''}\r\n\r\n                        {this.loading\r\n                            ? LoadingIndicator.component({ className: 'LoadingIndicator--block' })\r\n                            : !drafts.length && (\r\n                                  <div className=\"NotificationList-empty\">{app.translator.trans('fof-drafts.forum.dropdown.empty_text')}</div>\r\n                              )}\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    deleteDraft(draft) {\r\n        this.loading = true;\r\n\r\n        if (!window.confirm(app.translator.trans('fof-drafts.forum.dropdown.alert'))) return;\r\n\r\n        draft.delete().then(() => {\r\n            if (app.composer.component && app.composer.component.draft.id() === draft.id() && !app.composer.changed()) {\r\n                app.composer.hide();\r\n            }\r\n\r\n            this.loading = false;\r\n            m.redraw();\r\n        });\r\n    }\r\n\r\n    scheduleDraft(draft) {\r\n        if (!app.forum.attribute('canScheduleDrafts') || !app.forum.attribute('drafts.enableScheduledDrafts')) return;\r\n\r\n        app.modal.show(new ScheduleDraftModal({ draft }));\r\n    }\r\n\r\n    showComposer(draft) {\r\n        if (this.loading) return;\r\n\r\n        const deferred = m.deferred();\r\n\r\n        let componentClass;\r\n\r\n        switch (draft.type()) {\r\n            case 'privateDiscussion':\r\n                componentClass = require('@fof-byobu').components['PrivateDiscussionComposer'];\r\n                break;\r\n            case 'reply':\r\n                componentClass = ReplyComposer;\r\n                break;\r\n            default:\r\n                componentClass = DiscussionComposer;\r\n        }\r\n\r\n        const component = new componentClass(draft.compileData());\r\n\r\n        app.composer.load(component);\r\n        app.composer.show();\r\n\r\n        deferred.resolve(component);\r\n\r\n        return deferred.promise;\r\n    }\r\n\r\n    load() {\r\n        if (app.cache.draftsLoaded) {\r\n            return;\r\n        }\r\n\r\n        this.loading = true;\r\n        m.redraw();\r\n\r\n        app.store\r\n            .find('drafts')\r\n            .then(\r\n                () => (app.cache.draftsLoaded = true),\r\n                () => {}\r\n            )\r\n            .then(() => {\r\n                this.loading = false;\r\n                m.redraw();\r\n            });\r\n    }\r\n}\r\n","/*\r\n *\r\n *  This file is part of fof/drafts.\r\n *\r\n *  Copyright (c) 2019 FriendsOfFlarum.\r\n *\r\n *  For the full copyright and license information, please view the LICENSE.md\r\n *  file that was distributed with this source code.\r\n *\r\n */\r\n\r\nimport Page from 'flarum/components/Page';\r\n\r\nimport DraftsList from './DraftsList';\r\n\r\nexport default class DraftsPage extends Page {\r\n    init() {\r\n        super.init();\r\n\r\n        app.history.push('drafts');\r\n\r\n        this.list = new DraftsList();\r\n        this.list.load();\r\n\r\n        this.bodyClass = 'App--drafts';\r\n    }\r\n\r\n    view() {\r\n        return <div className=\"DraftsPage\">{this.list.render()}</div>;\r\n    }\r\n}\r\n","import Alert from 'flarum/components/Alert';\r\nimport Button from 'flarum/components/Button';\r\nimport Modal from 'flarum/components/Modal';\r\nimport LoadingIndicator from 'flarum/components/LoadingIndicator';\r\n\r\nimport load from 'external-load';\r\n\r\nexport default class ScheduleDraftModal extends Modal {\r\n    init() {\r\n        super.init();\r\n\r\n        this.loading = false;\r\n    }\r\n\r\n    className() {\r\n        return 'ScheduleDraftModal';\r\n    }\r\n\r\n    title() {\r\n        return app.translator.trans('fof-drafts.forum.schedule_draft_modal.title');\r\n    }\r\n\r\n    content() {\r\n        if (this.loading) {\r\n            return <LoadingIndicator />;\r\n        }\r\n\r\n        return [\r\n            this.props.draft.scheduledFor() ? (\r\n                <div className=\"Modal-alert\">\r\n                    <Alert type=\"success\" dismissible={false}>\r\n                        {app.translator.trans('fof-drafts.forum.schedule_draft_modal.scheduled_text', {\r\n                            datetime: moment(this.props.draft.scheduledFor()).format('LLLL'),\r\n                        })}\r\n                    </Alert>\r\n                </div>\r\n            ) : (\r\n                ''\r\n            ),\r\n            this.props.draft.scheduledValidationError() ? (\r\n                <div className=\"Modal-alert\">\r\n                    <Alert type=\"error\" dismissible={false}>\r\n                        {app.translator.trans('fof-drafts.forum.schedule_draft_modal.scheduled_error', {\r\n                            error: this.props.draft.scheduledValidationError(),\r\n                        })}\r\n                    </Alert>\r\n                </div>\r\n            ) : (\r\n                ''\r\n            ),\r\n            <input style=\"display: none\"></input>,\r\n            <div className=\"Modal-body\">\r\n                <div className=\"Form Form--centered\">\r\n                    <p className=\"helpText\">{app.translator.trans('fof-drafts.forum.schedule_draft_modal.text')}</p>\r\n                    <div className=\"Form-group flatpickr\">\r\n                        <input name=\"scheduledFor\" className=\"FormControl flatpickr-input\" data-input onchange={m.redraw} />\r\n                    </div>\r\n                    <div className=\"Form-group\">\r\n                        {Button.component({\r\n                            className: 'Button Button--block' + (this.unscheduleMode() ? ' Button--danger' : ' Button--primary'),\r\n                            type: 'submit',\r\n                            loading: this.loading,\r\n                            children: this.unscheduleMode()\r\n                                ? app.translator.trans('fof-drafts.forum.schedule_draft_modal.unschedule_button')\r\n                                : this.rescheduleMode()\r\n                                ? app.translator.trans('fof-drafts.forum.schedule_draft_modal.reschedule_button')\r\n                                : app.translator.trans('fof-drafts.forum.schedule_draft_modal.schedule_button'),\r\n                        })}\r\n                    </div>\r\n                </div>\r\n            </div>,\r\n        ];\r\n    }\r\n\r\n    config(isInitialized) {\r\n        if (isInitialized) return;\r\n\r\n        const url = app.forum.attribute('baseUrl') + '/assets/extensions/fof-drafts/flatpickr';\r\n\r\n        this.loading = true;\r\n\r\n        Promise.all(typeof flatpickr === 'undefined' ? [load.js(`${url}.js`), load.css(`${url}.css`)] : []).then(() => {\r\n            this.loading = false;\r\n\r\n            m.redraw();\r\n\r\n            this.flatpickr = flatpickr('.flatpickr-input', {\r\n                enableTime: true,\r\n                enableSeconds: false,\r\n                minDate: Date.now(),\r\n                maxDate: new Date(9999, 12, 31),\r\n                defaultDate: this.props.draft.scheduledFor(),\r\n            });\r\n        });\r\n    }\r\n\r\n    scheduledFor() {\r\n        return new Date($('input[name=scheduledFor]').val());\r\n    }\r\n\r\n    changed() {\r\n        const getTimeOrNull = (date) => (date ? date.getTime() : null);\r\n\r\n        return getTimeOrNull(this.scheduledFor()) !== getTimeOrNull(this.props.draft.scheduledFor());\r\n    }\r\n\r\n    unscheduleMode() {\r\n        return !this.changed() && this.props.draft.scheduledFor();\r\n    }\r\n\r\n    rescheduleMode() {\r\n        return this.changed() && this.props.draft.scheduledFor();\r\n    }\r\n\r\n    onsubmit(e) {\r\n        e.preventDefault();\r\n\r\n        this.loading = true;\r\n\r\n        this.props.draft\r\n            .save({ scheduledFor: this.unscheduleMode() ? null : this.scheduledFor(), clearValidationError: true, scheduledValidationError: '' })\r\n            .then(() => (this.success = true))\r\n            .catch(() => {})\r\n            .then(this.loaded.bind(this));\r\n    }\r\n}\r\n","/*\r\n *\r\n *  This file is part of fof/drafts.\r\n *\r\n *  Copyright (c) 2019 FriendsOfFlarum.\r\n *\r\n *  For the full copyright and license information, please view the LICENSE.md\r\n *  file that was distributed with this source code.\r\n *\r\n */\r\n\r\nimport { extend, override } from 'flarum/extend';\r\nimport User from 'flarum/models/User';\r\nimport Model from 'flarum/Model';\r\nimport Draft from './models/Draft';\r\nimport DraftsPage from './components/DraftsPage';\r\nimport addDraftsDropdown from './addDraftsDropdown';\r\nimport addPreferences from './addPreferences';\r\nimport Composer from 'flarum/components/Composer';\r\nimport DiscussionComposer from 'flarum/components/DiscussionComposer';\r\nimport ReplyComposer from 'flarum/components/ReplyComposer';\r\nimport Button from 'flarum/components/Button';\r\nimport DraftsList from './components/DraftsList';\r\nimport fillRelationship from './utils/fillRelationship';\r\n\r\napp.initializers.add('fof-drafts', () => {\r\n    app.store.models.drafts = Draft;\r\n    User.prototype.drafts = Model.hasMany('drafts');\r\n    User.prototype.draftCount = Model.attribute('draftCount');\r\n\r\n    app.routes.drafts = { path: '/drafts', component: <DraftsPage /> };\r\n\r\n    Composer.prototype['changed'] = function () {\r\n        if (!this.component) return false;\r\n\r\n        const data = this.component.data();\r\n        const draft = this.component.draft;\r\n\r\n        const fields = Object.keys(data).filter((element) => element !== 'relationships');\r\n\r\n        if (!fields) {\r\n            return false;\r\n        }\r\n\r\n        const getData = (field) => (field === 'content' ? this.component.editor.value() : data[field]) || '';\r\n\r\n        for (const field of fields) {\r\n            if ((!draft && getData(field)) || (draft && getData(field) != draft.data.attributes[field])) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        if (!data.relationships && !draft.relationships()) {\r\n            return false;\r\n        }\r\n\r\n        const relationships = Object.keys(data.relationships);\r\n\r\n        const equalRelationships = (data, draft, relationship) => {\r\n            if (\r\n                !data.relationships[relationship].length &&\r\n                (!(relationship in draft.relationships()) || !draft.relationships()[relationship].data.length)\r\n            ) {\r\n                return true;\r\n            } else if (\r\n                !(relationship in draft.relationships()) ||\r\n                data.relationships[relationship].length !== draft.relationships()[relationship].data.length\r\n            ) {\r\n                return false;\r\n            }\r\n\r\n            const getId = (element) => (typeof element.id == 'function' ? element.id() : element.id);\r\n\r\n            const dataIds = fillRelationship(data.relationships[relationship], getId);\r\n            const draftIds = fillRelationship(draft.relationships()[relationship].data, getId);\r\n\r\n            return !dataIds.some((id, i) => id !== draftIds[i]);\r\n        };\r\n\r\n        for (const relationship of relationships) {\r\n            if (!draft) {\r\n                if (data.relationships[relationship]) {\r\n                    return true;\r\n                }\r\n            } else {\r\n                if (!equalRelationships(data, draft, relationship)) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    Composer.prototype['saveDraft'] = function () {\r\n        this.saving = true;\r\n        m.redraw();\r\n\r\n        const afterSave = () => {\r\n            this.saving = false;\r\n            this.justSaved = true;\r\n            setTimeout(() => {\r\n                this.justSaved = false;\r\n                m.redraw();\r\n            }, 300);\r\n            m.redraw();\r\n        };\r\n\r\n        if (this.component.draft) {\r\n            delete this.component.draft.data.attributes.relationships;\r\n\r\n            this.component.draft.save(Object.assign(this.component.draft.data.attributes, this.component.data())).then(() => afterSave());\r\n        } else {\r\n            app.store\r\n                .createRecord('drafts')\r\n                .save(this.component.data())\r\n                .then((draft) => {\r\n                    draft.loadRelationships(true);\r\n                    this.component.draft = draft;\r\n                    afterSave();\r\n                });\r\n        }\r\n    };\r\n\r\n    extend(Composer.prototype, 'controlItems', function (items) {\r\n        if (\r\n            !(this.component instanceof DiscussionComposer || this.component instanceof ReplyComposer) ||\r\n            !app.forum.attribute('canSaveDrafts') ||\r\n            this.position === Composer.PositionEnum.MINIMIZED\r\n        )\r\n            return;\r\n\r\n        const classNames = ['Button', 'Button--icon', 'Button--link'];\r\n\r\n        if (this.saving) {\r\n            classNames.push('saving');\r\n        }\r\n\r\n        if (this.justSaved) {\r\n            classNames.push('justSaved');\r\n        }\r\n\r\n        items.add(\r\n            'save-draft',\r\n            Button.component({\r\n                icon: this.justSaved ? 'fas fa-check' : this.saving ? 'fas fa-spinner fa-spin' : 'fas fa-save',\r\n                className: classNames.join(' '),\r\n                itemClassName: 'App-backControl',\r\n                title: app.translator.trans('fof-drafts.forum.composer.title'),\r\n                disabled: this.saving || this.justSaved || this.loading,\r\n                onclick: this.saveDraft.bind(this),\r\n            }),\r\n            20\r\n        );\r\n    });\r\n\r\n    extend(Composer.prototype, 'load', function () {\r\n        if (!app.forum.attribute('canSaveDrafts')) return;\r\n\r\n        if (\r\n            app.session.user.preferences().draftAutosaveEnable &&\r\n            (this.component instanceof DiscussionComposer || this.component instanceof ReplyComposer)\r\n        ) {\r\n            this.autosaveInterval = setInterval(() => {\r\n                if (this.changed() && !this.saving && !this.loading) {\r\n                    this.saveDraft();\r\n                }\r\n            }, 1000 * app.session.user.preferences().draftAutosaveInterval);\r\n        }\r\n    });\r\n\r\n    extend(Composer.prototype, 'hide', function () {\r\n        if (this.autosaveInterval) clearInterval(this.autosaveInterval);\r\n    });\r\n\r\n    override(Composer.prototype, 'preventExit', function (original) {\r\n        if (this.component && this.component.draft) {\r\n            this.component.props.confirmExit = app.translator.trans('fof-drafts.forum.composer.exit_alert');\r\n        }\r\n\r\n        let prevented = false;\r\n        if (this.changed()) {\r\n            prevented = original();\r\n        }\r\n\r\n        if (prevented) return prevented;\r\n\r\n        if (!this.component) return;\r\n\r\n        const draft = this.component.draft;\r\n        if (draft && !draft.title() && !draft.content() && confirm(app.translator.trans('fof-drafts.forum.composer.discard_empty_draft_alert'))) {\r\n            draft.delete();\r\n        }\r\n\r\n        return prevented;\r\n    });\r\n\r\n    function initComposerBody() {\r\n        Object.keys(this.props).forEach((key) => {\r\n            if (!['originalContent', 'title', 'user'].includes(key)) {\r\n                this[key] = this.props[key];\r\n            } else if (key === 'title') {\r\n                this.title = m.prop(this.props.title);\r\n            }\r\n        });\r\n    }\r\n\r\n    extend(DiscussionComposer.prototype, 'init', initComposerBody);\r\n    extend(ReplyComposer.prototype, 'init', initComposerBody);\r\n\r\n    function deleteDraftsOnSubmit() {\r\n        if (this.draft) {\r\n            this.draft.delete();\r\n        }\r\n    }\r\n\r\n    extend(DiscussionComposer.prototype, 'onsubmit', deleteDraftsOnSubmit);\r\n    extend(ReplyComposer.prototype, 'onsubmit', deleteDraftsOnSubmit);\r\n\r\n    addDraftsDropdown();\r\n    addPreferences();\r\n});\r\n","/*\r\n *\r\n *  This file is part of fof/drafts.\r\n *\r\n *  Copyright (c) 2019 FriendsOfFlarum.\r\n *\r\n *  For the full copyright and license information, please view the LICENSE.md\r\n *  file that was distributed with this source code.\r\n *\r\n */\r\nimport Model from 'flarum/Model';\r\nimport ItemList from 'flarum/utils/ItemList';\r\nimport mixin from 'flarum/utils/mixin';\r\nimport fillRelationship from '../utils/fillRelationship';\r\n\r\nexport default class Draft extends mixin(Model, {\r\n    user: Model.hasOne('user'),\r\n    content: Model.attribute('content'),\r\n    title: Model.attribute('title'),\r\n    scheduledValidationError: Model.attribute('scheduledValidationError'),\r\n    relationships: Model.attribute('relationships'),\r\n    scheduledFor: Model.attribute('scheduledFor', Model.transformDate),\r\n    updatedAt: Model.attribute('updatedAt', Model.transformDate),\r\n\r\n    loadedRelationships: null,\r\n\r\n    type() {\r\n        const relationships = this.loadRelationships();\r\n        if (relationships.discussion) {\r\n            return 'reply';\r\n        } else if (\r\n            flarum.extensions['fof-byobu'] &&\r\n            flarum.extensions['fof-byobu'].components && // If private discussion composer is not exported, we can't support PM drafts.\r\n            ('recipientGroups' in relationships || 'recipientUsers' in relationships)\r\n        ) {\r\n            return 'privateDiscussion';\r\n        } else {\r\n            return 'discussion';\r\n        }\r\n    },\r\n\r\n    icon() {\r\n        switch (this.type()) {\r\n            case 'discussion':\r\n                return 'fas fa-edit';\r\n            case 'reply':\r\n                return 'fas fa-reply';\r\n            case 'privateDiscussion':\r\n                return 'fas fa-eye-slash';\r\n        }\r\n    },\r\n\r\n    loadRelationships(force) {\r\n        if (\r\n            !force &&\r\n            this.loadedRelationships &&\r\n            (Object.keys(this.loadedRelationships).length > 0 ||\r\n                (Object.keys(this.loadedRelationships).length === 0 && Object.keys(this.relationships).length === 0))\r\n        ) {\r\n            return this.loadedRelationships;\r\n        }\r\n\r\n        this.loadedRelationships = {};\r\n\r\n        const relationships = this.relationships();\r\n\r\n        if (relationships) {\r\n            Object.keys(relationships).forEach((relationshipName) => {\r\n                const relationship = relationships[relationshipName];\r\n\r\n                if (!relationship || !relationship.data) return;\r\n\r\n                this.loadedRelationships[relationshipName] = fillRelationship(relationship.data, (model) => app.store.getById(model.type, model.id));\r\n            });\r\n        }\r\n\r\n        if ('recipientUsers' in this.loadedRelationships || 'recipientGroups' in this.loadedRelationships) {\r\n            const recipients = new ItemList();\r\n\r\n            (this.loadedRelationships['recipientUsers'] || []).forEach((user) => {\r\n                if (user) recipients.add('users:' + user.id(), user);\r\n            });\r\n            (this.loadedRelationships['recipientGroups'] || []).forEach((group) => {\r\n                if (group) recipients.add('groups:' + group.id(), group);\r\n            });\r\n\r\n            this.loadedRelationships['recipients'] = recipients;\r\n        }\r\n\r\n        return this.loadedRelationships;\r\n    },\r\n\r\n    compileData() {\r\n        const data = {\r\n            originalContent: this.content(),\r\n            title: this.title(),\r\n            user: app.session.user,\r\n            confirmExit: app.translator.trans('fof-drafts.forum.composer.exit_alert'),\r\n            draft: this,\r\n        };\r\n\r\n        Object.assign(data, this.loadRelationships());\r\n\r\n        return data;\r\n    },\r\n}) {}\r\n","export default (data, map) => (Array.isArray(data) ? data.map(map).sort() : map(data));\r\n","module.exports = flarum.extensions['fof-byobu'];","module.exports = flarum.core.compat['Component'];","module.exports = flarum.core.compat['Model'];","module.exports = flarum.core.compat['app'];","module.exports = flarum.core.compat['components/Alert'];","module.exports = flarum.core.compat['components/Button'];","module.exports = flarum.core.compat['components/Composer'];","module.exports = flarum.core.compat['components/DiscussionComposer'];","module.exports = flarum.core.compat['components/FieldSet'];","module.exports = flarum.core.compat['components/HeaderSecondary'];","module.exports = flarum.core.compat['components/LoadingIndicator'];","module.exports = flarum.core.compat['components/Modal'];","module.exports = flarum.core.compat['components/NotificationsDropdown'];","module.exports = flarum.core.compat['components/Page'];","module.exports = flarum.core.compat['components/ReplyComposer'];","module.exports = flarum.core.compat['components/SettingsPage'];","module.exports = flarum.core.compat['components/Switch'];","module.exports = flarum.core.compat['extend'];","module.exports = flarum.core.compat['helpers/avatar'];","module.exports = flarum.core.compat['helpers/humanTime'];","module.exports = flarum.core.compat['helpers/icon'];","module.exports = flarum.core.compat['models/User'];","module.exports = flarum.core.compat['utils/ItemList'];","module.exports = flarum.core.compat['utils/mixin'];","module.exports = flarum.core.compat['utils/string'];"],"sourceRoot":""}